<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- theme-color: Not supported by Firefox, but essential for Chrome/Safari/Edge PWA -->
    <meta name="theme-color" content="#1e40af">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>WRC Coach - Wilhelmsburger Ruder Club</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="icon.svg">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <button class="menu-btn" id="menuBtn" aria-label="Settings (Press S)" title="Settings (Press S)">
                <span class="menu-icon"></span>
                <span class="menu-icon"></span>
                <span class="menu-icon"></span>
            </button>
            <h1><img src="wrc-logo.jpg" alt="WRC" class="logo-img"> WRC Coach</h1>
            <div class="status-indicator" id="status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Ready</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Metrics Bar -->
            <div class="metrics-bar">
                <div class="metric-card">
                    <div class="metric-label">Stroke Rate</div>
                    <div class="metric-value" id="strokeRate">--</div>
                    <div class="metric-unit">SPM</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Drive %</div>
                    <div class="metric-value" id="drivePercent">--</div>
                    <div class="metric-unit">%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Split</div>
                    <div class="metric-value" id="boatSpeed">--</div>
                    <div class="metric-unit">/500m</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Samples</div>
                    <div class="metric-value" id="sampleCount">0</div>
                    <div class="metric-unit">pts</div>
                </div>
            </div>

            <!-- Polar Plot -->
            <div class="chart-container">
                <h2 class="chart-title">Stroke Cycle Analysis</h2>
                <canvas id="polarCanvas"></canvas>
                <div class="chart-legend compact">
                    <span class="legend-item drive">‚ñ† Drive</span>
                    <span class="legend-item recovery">‚ñ† Recovery</span>
                </div>
            </div>

            <!-- Stability Plot -->
            <div class="chart-container">
                <h2 class="chart-title">Boat Stability (Roll) - Stroke Cycle</h2>
                <canvas id="stabilityCanvas"></canvas>
                <div class="chart-legend compact">
                    <span class="legend-item port">‚Üê Port</span>
                    <span class="legend-item starboard">Starboard ‚Üí</span>
                </div>
            </div>
        </main>

        <!-- Control Panel -->
        <div class="control-panel">
            <button id="calibrateBtn" class="btn btn-secondary">
                <span class="btn-icon">üéØ</span>
                Calibrate
            </button>
            <button id="startBtn" class="btn btn-primary">
                <span class="btn-icon">‚ñ∂</span>
                Start Session
            </button>
            <button id="stopBtn" class="btn btn-danger" disabled>
                <span class="btn-icon">‚èπ</span>
                Stop
            </button>
            <button id="exportBtn" class="btn btn-secondary" disabled>
                <span class="btn-icon">üíæ</span>
                Export CSV
            </button>
        </div>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-header">
                <h2>
                    ‚öôÔ∏è Settings
                    <span class="keyboard-hint">ESC to close</span>
                </h2>
                <button class="close-settings" id="closeSettings" aria-label="Close settings">√ó</button>
            </div>
            
            <div class="settings-content">
                <!-- Visualization Settings -->
                <div class="settings-section">
                    <h3>Visualization</h3>
                    
                    <div class="setting-item">
                        <label for="historyStrokes">Historical Strokes</label>
                        <div class="setting-control">
                            <input type="range" id="historyStrokes" min="0" max="5" value="2" step="1">
                            <span id="historyStrokesValue">2</span>
                        </div>
                        <p class="setting-help">Show fading history of previous strokes</p>
                    </div>
                    
                    <div class="setting-item">
                        <label for="trailOpacity">Trail Opacity</label>
                        <div class="setting-control">
                            <input type="range" id="trailOpacity" min="10" max="80" value="40" step="10">
                            <span id="trailOpacityValue">40%</span>
                        </div>
                        <p class="setting-help">Opacity of historical stroke trails</p>
                    </div>
                </div>
                
                <!-- Detection Settings -->
                <div class="settings-section">
                    <h3>Stroke Detection</h3>
                    
                    <div class="setting-item">
                        <label for="catchThreshold">Catch Threshold</label>
                        <div class="setting-control">
                            <input type="range" id="catchThreshold" min="0.3" max="1.2" value="0.6" step="0.1">
                            <span id="catchThresholdValue">0.6 m/s¬≤</span>
                        </div>
                        <p class="setting-help">Acceleration threshold for detecting catch</p>
                    </div>
                    
                    <div class="setting-item">
                        <label for="finishThreshold">Finish Threshold</label>
                        <div class="setting-control">
                            <input type="range" id="finishThreshold" min="-0.8" max="-0.1" value="-0.3" step="0.1">
                            <span id="finishThresholdValue">-0.3 m/s¬≤</span>
                        </div>
                        <p class="setting-help">Acceleration threshold for detecting finish</p>
                    </div>
                </div>
                
                <!-- Data Settings -->
                <div class="settings-section">
                    <h3>Data Recording</h3>
                    
                    <div class="setting-item">
                        <label for="sampleRate">Display Sample Rate</label>
                        <div class="setting-control">
                            <input type="range" id="sampleRate" min="10" max="30" value="20" step="5">
                            <span id="sampleRateValue">20 FPS</span>
                        </div>
                        <p class="setting-help">Chart update frequency (lower = better battery)</p>
                    </div>
                    
                    <div class="setting-item">
                        <label for="demoMode" class="checkbox-label">
                            <input type="checkbox" id="demoMode" class="toggle-checkbox">
                            <span>Demo Mode (25 SPM)</span>
                        </label>
                        <p class="setting-help">Simulate GPS and IMU data for testing without sensors</p>
                    </div>
                </div>
                
                <!-- Reset Button -->
                <div class="settings-section">
                    <button class="btn btn-secondary full-width" id="resetSettings">
                        <span class="btn-icon">üîÑ</span>
                        Reset to Defaults
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Settings Overlay -->
        <div id="settingsOverlay" class="settings-overlay"></div>

        <!-- Calibration Modal -->
        <div id="calibrationModal" class="modal">
            <div class="modal-content">
                <h2>Sensor Calibration</h2>
                <div class="calibration-step">
                    <p>Place phone with screen facing up, top toward bow</p>
                    <div class="offset-input">
                        <label for="offsetY">Offset from centerline (cm):</label>
                        <input type="range" id="offsetY" min="-40" max="40" value="0" step="1">
                        <span id="offsetYValue">0 cm</span>
                    </div>
                    <div class="offset-input">
                        <label for="offsetX">Fore/Aft offset (cm):</label>
                        <input type="range" id="offsetX" min="-40" max="40" value="0" step="1">
                        <span id="offsetXValue">0 cm</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="cancelCalibration" class="btn btn-secondary">Cancel</button>
                    <button id="confirmCalibration" class="btn btn-primary">Calibrate Now</button>
                </div>
            </div>
        </div>

        <!-- Info Toast -->
        <div id="toast" class="toast"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>

